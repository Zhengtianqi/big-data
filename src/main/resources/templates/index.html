<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--css start-->
    <link th:href="@{/css/bootstrap.css}" rel="stylesheet" type="text/css">
    <!--css end-->

    <title>小区人员管理系统</title>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">

                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="#">小区人员管理系统</a>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="navbar-nav">
                        <li class="nav-item active">
                            <div class="input-append">
                                姓名：
                                <input class="span4" id="name_search" type="text">
                                <button class="btn bg-dark text-white" type="button" href="#"
                                        th:onclick="serachPersonModal()">搜索
                                </button>
                                <button class="btn bg-primary text-white" data-toggle="modal"
                                        data-target="#addPersonModal">增加
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2">
        </div>
        <div class="col-md-8">
            <table class="table">
                <thead>
                <tr style="background-color: #fbedce;">
                    <td>编号</td>
                    <td>姓名</td>
                    <td>年龄</td>
                    <td>是否本小区</td>
                    <td>操作</td>
                </tr>
                </thead>
                <tbody>
                <tr th:each="person : ${personList}">
                    <td th:text="${person.id}"></td>
                    <td th:text="${person.name}"></td>
                    <td th:text="${person.age}"></td>
                    <td th:text="${person.isNeighbourhood}"></td>
                    <td>
                        <button class="btn bg-primary text-white"
                                th:onclick="updateAsk([[${person.id}]]);">修改
                        </button>
                        <button class="btn btn-danger text-white"
                                th:onclick="removeAsk([[${person.id}]]);">删除
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-2">
        </div>
    </div>
</div>
<!--js start-->
<!--jquery.js需要在bootstrap.js之前,不然会报错.bootstrap会用到jquery的库-->
<script th:src="@{/js/jquery-3.3.1.js}"></script>
<script th:src="@{/js/bootstrap.js}"></script>
<script charset="utf-8">
    let ctx = '[[${#httpServletRequest.getContextPath()}]]';

    /*添加*/
    function addPerson() {
        let id = $("#id").val();
        let name = $("#name").val();
        let age = $("#age").val();
        let isNeighbourhood = $("#isNeighbourhood").val();
        $.ajax({
            url: ctx + "/addPerson",
            type: "POST",
            data: {
                "id": id,
                "name": name,
                "age": age,
                "isNeighbourhood": isNeighbourhood
            },
            dataType: "text",
            success: function (data) {
                if (data === "success") {
                    alert("保存成功！");
                    setTimeout(function () {
                        //让打开这个窗口的父窗口刷新，然后本子窗口关闭！
                        window.parent.location.reload();
                    }, 1000);
                } else if (data === "exists") {
                    alert("该编号已经存在！");
                } else {
                    alert("添加错误！");
                }
            }
        });
    }


    /*修改前弹窗*/
    function updateAsk(id) {
        if (id != "" && id != null) {
            $.ajax({
                url: ctx + "/getPersonById",
                type: "GET",
                data: {
                    "id": id
                },
                dataType: "text",
                success: function (data) {
                    let json = JSON.parse(data);
                    for (let key in json) {
                        $("#" + key + "_update").val(json[key]);
                    }
                    $('#updatePersonModal').modal('show');
                }
            });
        } else {
            alert("修改失败！");
        }
    }

    /*修改*/
    function updatePerson() {
        let id = $("#id_update").val();
        let name = $("#name_update").val();
        let age = $("#age_update").val();
        let isNeighbourhood = $("#isNeighbourhood_update").val();

        $.ajax({
            url: ctx + "/updatePerson",
            type: "POST",
            data: {
                "id": id,
                "name": name,
                "age": age,
                "isNeighbourhood": isNeighbourhood
            },
            dataType: "text",
            success: function (data) {
                if (data === "success") {
                    setTimeout(function () {
                        //让打开这个窗口的父窗口刷新，然后本子窗口关闭！
                        window.parent.location.reload();
                    }, 1000);
                } else {
                    alert("修改失败！");
                }
            }
        });
    }

    /*删除前提示*/
    function removeAsk(id) {
        if (id !== "" && id !== null) {
            $("#removePersonId").val(id);
            $('#removePersonModal').modal('show');
        } else {
            alert("删除失败！");
        }
    }

    /*删除*/
    function removePerson() {
        let id = $("#removePersonId").val();
        if (id !== "" && id !== null) {
            $.ajax({
                url: ctx + "/deletePerson",
                type: "POST",
                data: {
                    "id": id
                },
                dataType: "text",
                success: function (data) {
                    $('#removePersonModal').modal('hide');
                    setTimeout(function () {
                        //让打开这个窗口的父窗口刷新，然后本子窗口关闭！
                        window.parent.location.reload();
                    }, 1000);
                }
            });
        } else {
            alert("删除失败！");
        }
    }

    /*删除返回*/
    function removePersonReturn() {
        $("#removePersonId").val("");
        $('#removePersonModal').modal('hide');
    }

    /*搜索*/
    function serachPersonModal() {
        let name = $("#name_search").val();
        window.location.href = ctx + "/index?name=" + name;
    }

</script>
<!--js end-->

<!--隐藏的DIV-->
<div>
    <!-- 添加模态框（Modal） -->
    <div class="modal fade" id="addPersonModal" tabindex="-1" role="dialog" aria-labelledby="addPersonModal"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">小区人员添加</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    编号: <input class="span4" id="id" type="text"><a style="color: red">*</a><br>
                    姓名: <input class="span4" id="name" type="text"><a style="color: red">*</a><br>
                    年龄: <input class="span4" id="age" type="text"><a style="color: red">*</a><br>
                    是否本小区:
                    <select class="span4" id="isNeighbourhood">
                        <option value="是">是</option>
                        <option value="否">否</option>
                    </select><a style="color: red">*</a><br>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" th:onclick="addPerson()">保存</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <!-- 修改模态框（Modal） -->
    <div class="modal fade" id="updatePersonModal" tabindex="-1" role="dialog"
         aria-labelledby="updatePersonModal"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="ModalLabel">小区人员修改</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <input class="span4" id="id_update" type="text" value="" style="display: none;">
                    姓名: <input class="span4" id="name_update" type="text" value=""><a style="color: red">*</a><br>
                    年龄: <input class="span4" id="age_update" type="text" value=""><a style="color: red">*</a><br>
                    是否本小区:
                    <select class="span4" id="isNeighbourhood_update">
                        <option value="是">是</option>
                        <option value="否">否</option>
                    </select><a style="color: red">*</a><br>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" th:onclick="updatePerson()">保存</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <!-- 删除确认模态框（Modal） -->
    <div class="modal fade" id="removePersonModal" tabindex="-1" role="dialog"
         aria-labelledby="removePersonModal"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="deleteModalLabel">确认框</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label class="control-label">确定要删除吗？</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" th:onclick="removePerson()">确认</button>
                    <button type="button" class="btn btn-default" th:onclick="removePersonReturn()">返回
                    </button>
                </div>
            </div>
        </div>
    </div>
    <input id="removePersonId" style="display: none;"/>
</div>
</body>
</html>